<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>What is dependency injection?</title>
  <meta name="description" content="Educational content on dependency injection and composition" />
  <meta name="keywords" content="dependency injection, composition, software design, learn programming" />
  <meta name="author" content="Tomasz Kwiatkowski" />
  <link rel="preload" href="/menu-icon.svg" as="image">
  <link rel="preload" href="/brightness.svg" as="image">
</head>

<body>
  <div class="layout layout--collapsed" data-theme='dark'>
    <header class="layout__header">
      <div class="header__buttons-wrapper">
        <button class="header__button">
          <img src="/brightness.svg" alt="brightness icon" class="header__icon--dynamic" />
        </button>
      </div>
      <h1 class="header__title">
        What even is
        <!-- The "d" is a workaround for consistent height on small screens -->
        <span class="header__title--effect">d</span>
      </h1>
      <nav class="header__navigation-menu">
        <div class="navigation__icons-wrapper">
          <div class="header__language-dropdown">
            <button class="header__language--en header__language">en</button>
            <button class="header__language--pl header__language">pl</button>
          </div>
          <button class="navigation__language-icon header__language-icon">
            <img src="/language-icon.svg" alt="language icon" class="" />
          </button>
          <button class="navigation__theme-icon">
            <img src="/brightness.svg" alt="brightness icon" class="" />
          </button>
        </div>
        <ol class="header__navigation-list">
          <li class="navigation__item--section">f
            dsfsdfsdfsdf
            <ol class="navigation__sublist">
              <li class="navigation__item--subsection">dsadas</li>
              <li class="navigation__item--subsection">dsdasdsaadas</li>
              <li class="navigation__item--subsection">dsadda</li>
            </ol>
          </li>
          <li class="navigation__item--section">
            dasdas
            <ol class="navigation__sublist">
              <li class="navigation__item--subsection">dsad</li>
              <li class="navigation__item--subsection">dsadas</li>
            </ol>
          </li>
          <li class="navigation__item--section">dsadas</li>
        </ol>
      </nav>
      <div class="header__language-wrapper">
        <button class="header__button--secondary header__language-icon">
          <img src="/language-icon.svg" alt="language icon" />
        </button>
        <div class="header__language-dropdown">
          <button class="header__language--en header__language">en</button>
          <button class="header__language--pl header__language">pl</button>
        </div>
      </div>
    </header>

    <nav class="layout__sidebar">
      <button class="sidebar__button">
        <img src="/menu-icon.svg" alt="hamburger menu icon" class="button__icon" />
      </button>
      <div class="sidebar__navigation-wrapper">
        <div class="sidebar__effect-container"></div>
        <ol class="sidebar__navigation-list">
          <li class="sidebar__item--section sidebar__item" tabindex="1">
            Introduction
          </li>
          <li class="sidebar__item--section sidebar__item" tabindex="2">
            Composition
          </li>
          <li class="sidebar__item--subsection sidebar__item" tabindex="3">
            dsjndjsnj
          </li>
          <li class="sidebar__item--section sidebar__item" tabindex="4">
            dsaidsajn
          </li>
          <li class="sidebar__item--subsection sidebar__item" tabindex="5">
            dsaidsajn
          </li>
        </ol>
      </div>

    </nav>
    <main class="layout__content">
      <div class="content__wrapper">
        <div class="content__section">
          <section class="section__intro">
            <h1 class="section__item">
              Introduction
            </h1>
            <p class="section__item">
              Dependency injection is a design pattern where objects receive their
              dependencies from an external source rather than creating them internally.
              This makes code less tightly coupled and easier to modify. While it can sound
              complex, it's actually a straightforward idea that every programmer should
              know. The main reasons to learn and use dependency injection are:
            </p>
            <ul class="section__list">
              <li class="section__list-item">
                Greater flexibility by decoupling components
                and allowing easy replacement of implementations
              </li>
              <li class="section__list-item">
                Simpler, more isolated testing by injecting mock or stub dependencies
              </li>
              <li class="section__list-item">
                Improved maintainability and scalability as systems grow more complex
              </li>
            </ul>
            <div class="section__information-block">
              <div class="information__text">
                <div class="information__beginning">
                  <img src="/information-icon.svg" class="section__info-icon" alt="information icon">
                  <h3 class="section__item">Do I need to know C# to understand this?</h3>
                </div>
                The examples in this article do use specific C# related methods and keywords,
                but the knowledge of C# is absolutely not needed to be able to read this article.
                Focus on the general concepts and higher level ideas.
              </div>
            </div>
            <p class="section__item">
              Before we get to it,
              we must first talk about...
            </p>
          </section>
          <section class="section__composition">
            <h1 class="section__item">
              Composition
            </h1>
            <p class="section__item">
              Let's say we have a simple abstract
              <span class="section__code-fragment">class Database</span>
              that supports 3 actions: opening a connection to the database, closing
              the connection and executing an SQL query that returns a IDataReader object.
            </p>
            <ul class="section__list">
              <li class="section__list-item">
                Opening a connection to the database.
              </li>
              <li class="section__list-item">
                Closing the connection we opened.
              </li>
              <li class="section__list-item">
                Executing an SQL query (returning an <span class="section__code-fragment">IDataReader</span>).
              </li>
            </ul>
            <div class="code__wrapper">
              <pre class="line-numbers language-csharp">
                <code class="language-csharp">
                  public abstract class Database
                  {
                      public required IDbConnection Connection { get; init; }

                      public Database(IDbConnection connection)
                      {
                          Connection = connection;
                      }

                      public Database() { }

                      public void Open()
                      {
                          if (Connection.State != ConnectionState.Open)
                          {
                              Connection.Open();
                          }
                      }

                      public void Close()
                      {
                          if (Connection.State != ConnectionState.Closed)
                          {
                              Connection.Close();
                          }
                      }

                      public abstract IDataReader ExecuteSqlQuery(
                        string sql,
                        CommandType commandType,
                        params IDataParameter[] queryParameters);
                  }
                </code>
              </pre>
            </div>
            <p class="section__item">
              We want to make two specific database subclasses that inherit from it.
            </p>
            <ul class="section__list">
              <li class="section__list-item">
                One for
                <span class="section__code-fragment">MySQL</span>
              </li>
              <li class="section__list-item">
                One for
                <span class="section__code-fragment">MongoDB</span>
              </li>
            </ul>
            <p class="section__item">Here's the MySQL implementation</p>
            <div class="code__wrapper">
              <pre class="line-numbers language-csharp">
                <code class="language-csharp">
                  public sealed class MySql : Database 
                  {
                      public override IDataReader ExecuteSqlQuery(
                          string sql,
                          CommandType commandType = CommandType.Text,
                          params IDataParameter[] queryParameters)
                      {
                          using var command = Connection.CreateCommand();
                          command.CommandText = sql;
                          command.CommandType = commandType;

                          if (queryParameters != null)
                          {
                              foreach (var param in queryParameters)
                              {
                                  command.Parameters.Add(param);
                              }
                          }

                          return command.ExecuteReader(CommandBehavior.CloseConnection);
                      }
                  }
                </code>
              </pre>
            </div>
            <p class="section__item">
              This works well.
              <span class="section__code-fragment">MySQL</span>
              is an SQL database, so it makes sense to override ExecuteSqlQuery.
            </p>
            <p class="section__item">
              But here's what happens when we try to do the same for MongoDB:
            </p>
            <div class="code__wrapper">
              <pre class="line-numbers language-csharp" data-line="8">
                <code class="language-csharp">
                  public sealed class MongoDb : Database
                  {
                      public override IDataReader ExecuteSqlQuery(
                          string sql,
                          CommandType commandType,
                          params IDataParameter[] queryParameters)
                      {
                          throw new NotImplementedException("MongoDB is a NoSQL database!");
                      }
                  }
                </code>
              </pre>
            </div>
            <p class="section__item">
              We have a problem. The parent forces
              <span class="section__code-fragment">MongoDB</span>
              into declaring its own
              <span class="section__code-fragment">ExecuteSqlQuery</span>
              method even though it's
              a NoSQL database so we end up with a method that only throws an error.
            </p>
            <p class="section__item">
              We could instead make a
              <span class="section__code-fragment">DatabaseSqlQueryExecutor class</span>
              that takes on the responsibility of providing a
              <span class="section__code-fragment">ExecuteSqlQuery</span>
              method to override.
            </p>
            <div class="code__wrapper">
              <pre class="line-numbers language-csharp">
                <code class="language-csharp">
                  public class Database
                  {
                      public required IDbConnection Connection { get; init; }

                      public Database(IDbConnection connection)
                      {
                          Connection = connection;
                      }

                      public Database() { }

                      public void Open()
                      {
                          if (Connection.State != ConnectionState.Open)
                          {
                              Connection.Open();
                          }
                      }

                      public void Close()
                      {
                          if (Connection.State != ConnectionState.Closed)
                          {
                              Connection.Close();
                          }
                      }
                  };

                  public abstract class DatabaseSqlQueryExecutor : Database
                  {
                      public abstract IDataReader ExecuteSqlQuery(
                          string sql,
                          CommandType commandType,
                          params IDataParameter[] queryParameters);
                  }

                  public sealed class MySql : DatabaseSqlQueryExecutor
                  {
                      public override IDataReader ExecuteSqlQuery(
                          string sql,
                          CommandType commandType = CommandType.Text,
                          params IDataParameter[] queryParameters)
                      {
                          using var command = Connection.CreateCommand();
                          command.CommandText = sql;
                          command.CommandType = commandType;

                          if (queryParameters != null)
                          {
                              foreach (var param in queryParameters)
                              {
                                  command.Parameters.Add(param);
                              }
                          }

                          return command.ExecuteReader(CommandBehavior.CloseConnection);
                      }
                  }
                </code>
              </pre>
            </div>
            <p class="section__item">
              But this now quickly becomes a very awkward and cumbersome class hierarchy.
              Alternatively we could make a separate NoSqlDatabase parent class.
              Both of these approaches suffer from the issue of rigid class hierarchies.
              Depending on how big the codebase is, this could cause expensive refactoring.
            </p>
          </section>
          <div class="section__information-block">
            <div class="information__text">
              <div class="information__beginning">
                <img src="/information-icon.svg" class="section__info-icon" alt="information icon">
                <h3 class="section__item">dasdasd</h3>
              </div>
              dsadasdasdsadasdas dsadas dasdas
            </div>
          </div>
          <h3 class="section__item">dsadasdas</h3>
          <ul class="section__list">
            <li class="section__list-item">sadasdasd</li>
            <li class="section__list-item">dasdasdasd</li>
            <li class="section__list-item">dasdasdas</li>
          </ul>
          </section>
        </div>
      </div>
    </main>

    <footer class="layout__footer">
      <a href="https://github.com/tkwiatkowskii" class="footer__github-icon" target="_blank" rel="noopener noreferrer">
        <img src="/github-mark-white.svg" alt="github link icon">
      </a>
      <address class="footer__contact-information">
        <a href="mailto:tomaszkwiatkowski191@gmail.com">tomaszkwiatkowski191@gmail.com</a>
      </address>
    </footer>
  </div>
  <script type="module" src="/src/scripts/main.ts" defer></script>
</body>

</html>